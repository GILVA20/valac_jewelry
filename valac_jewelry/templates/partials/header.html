<header class="fixed top-[32px] left-0 right-0 z-40 bg-white/95 backdrop-blur shadow-md">
  <style>
    /* micro detalles visuales */
    .nav-link{position:relative}
    .nav-link:after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:#D4AF37;transition:width .2s ease}
    .nav-link:hover:after,.nav-link[aria-current="page"]:after{width:100%}
    .btn-cart-bling{transition:transform .15s ease}
    .btn-cart-bling:hover{transform:translateY(-1px)}
    .badge-count{min-width:1.25rem;height:1.25rem;font-size:.75rem;line-height:1.25rem}
    @media (prefers-reduced-motion:no-preference){
      .badge-pulse{animation:badgePulse 2.2s ease-in-out infinite}
      @keyframes badgePulse{0%,100%{box-shadow:0 0 0 0 rgba(212,175,55,.45)}50%{box-shadow:0 0 0 .5rem rgba(212,175,55,0)}}
    }
  </style>

  <div class="container mx-auto flex justify-between items-center px-4 md:px-6 py-3 md:py-4">
    <!-- Logo -->
    <a href="/" class="text-2xl sm:text-3xl md:text-4xl font-playfair tracking-wide nav-link hover:text-[#D4AF37]">
      VALAC Joyas
    </a>

    <!-- Botón hamburguesa (móvil) -->
    <button id="menu-toggle"
            class="lg:hidden text-3xl focus:outline-none"
            aria-label="Abrir menú" aria-expanded="false" aria-controls="mobile-menu">
      <i class="fas fa-bars" aria-hidden="true"></i>
    </button>

    <!-- NAV (desktop) -->
    <nav class="hidden lg:flex items-center gap-5 xl:gap-7 text-lg lg:text-xl text-[#1f2937]">
      <a href="/" class="nav-link hover:text-[#D4AF37]">Inicio</a>

      <!-- Colección + MEGA-MENÚ -->
      <div class="relative group">
        <button id="mega-trigger"
                class="nav-link hover:text-[#D4AF37] flex items-center gap-1"
                aria-haspopup="true" aria-expanded="false">
          Colección
          <svg class="w-4 h-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <!-- MEGA-MENÚ -->
        <div id="mega-menu"
             class="absolute left-1/2 -translate-x-1/2 top-full mt-3 w-[680px] max-w-[92vw]
                    bg-white rounded-2xl shadow-xl ring-1 ring-gray-200 p-6
                    opacity-0 invisible translate-y-2 transition duration-200 ease-out
                    group-hover:visible group-hover:opacity-100 group-hover:translate-y-0
                    group-focus-within:visible group-focus-within:opacity-100 group-focus-within:translate-y-0 z-50">
          <div class="grid grid-cols-2 gap-8 text-[#424242]">
            {% for g in ['Hombre','Mujer'] %}
            <div>
              <h4 class="font-bold text-xl flex items-center gap-2">
                {{ g }}
                <span class="h-[2px] w-12 bg-[#D4AF37] inline-block ml-2"></span>
              </h4>
              <ul class="mt-3 space-y-2">
                {% for c in ['aretes','cadenas','anillos','dijes','pulsos'] %}
                <li>
                  <a href="/collection?genero={{ g }}&category={{ c }}&mix_unisex=1"
                     class="flex items-center gap-2 py-1 px-2 rounded-md hover:bg-gray-50 hover:text-[#D4AF37] capitalize">
                    <i class="fas fa-gem text-sm opacity-80"></i>
                    {{ c }}
                  </a>
                </li>
                {% endfor %}
              </ul>
              <a href="/collection?genero={{ g }}&mix_unisex=1"
                 class="mt-4 inline-flex items-center gap-2 text-sm text-[#1f2937] hover:text-[#D4AF37]">
                Ver todo {{ g }} <i class="fas fa-arrow-right text-xs"></i>
              </a>
            </div>
            {% endfor %}
          </div>

          <div class="mt-5 pt-4 border-t border-gray-100 flex items-center justify-between">
            <a href="/collection?category=ofertas" class="inline-flex items-center gap-2 text-[#7A0019] font-semibold">
              <i class="fas fa-bolt"></i> Ofertas activas
            </a>
            <a href="/collection" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border border-[#D4AF37] text-[#1f2937] hover:bg-[#D4AF37] hover:text-black transition">
              Explorar toda la colección
            </a>
          </div>
        </div>
      </div>

      <a href="/about"   class="nav-link hover:text-[#D4AF37]">Sobre&nbsp;Nosotros</a>
      <a href="/contact" class="nav-link hover:text-[#D4AF37]">Contacto</a>

      <!-- Carrito -->
      <a href="/cart"
         class="btn-cart-bling relative inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-[#D4AF37]/60 hover:border-[#D4AF37] transition">
        <i class="fas fa-shopping-cart text-xl" aria-hidden="true"></i>
        <span>Carrito</span>
        <span class="badge-count badge-pulse absolute -top-2 -right-2 rounded-full bg-[#D4AF37] text-black font-semibold text-center px-1">
          {{ cart_count|default(0) }}
        </span>
      </a>
    </nav>

    <!-- Redes -->
    <div class="hidden lg:flex items-center gap-4 text-2xl">
      <a href="#" class="hover:text-[#D4AF37]"><i class="fab fa-facebook"  aria-hidden="true"></i></a>
      <a href="#" class="hover:text-[#D4AF37]"><i class="fab fa-instagram" aria-hidden="true"></i></a>
      <a href="#" class="hover:text-[#D4AF37]"><i class="fab fa-twitter"   aria-hidden="true"></i></a>
    </div>
  </div>

  <!-- Menú móvil -->
  <div id="mobile-menu" class="hidden lg:hidden bg-white shadow-md border-t border-gray-100">
    <nav class="flex flex-col p-4 space-y-2 text-[17px]">
      <a href="/" class="py-2 px-3 rounded-md hover:bg-gray-100">Inicio</a>

      <!-- Acordeón Colección -->
      <details class="rounded-md">
        <summary class="py-2 px-3 rounded-md hover:bg-gray-100 cursor-pointer list-none flex justify-between items-center">
          <span class="font-semibold">Colección</span>
          <i class="fas fa-chevron-down text-sm opacity-70"></i>
        </summary>
        <div class="mt-2 space-y-3 pl-3">
          {% for g in ['Hombre','Mujer'] %}
          <div>
            <div class="font-semibold text-[#D4AF37]">{{ g }}</div>
            <div class="flex flex-col ml-2">
              {% for c in ['aretes','cadenas','anillos','dijes','pulsos'] %}
                <a href="/collection?genero={{ g }}&category={{ c }}&mix_unisex=1"
                   class="py-1.5 px-2 rounded-md hover:bg-gray-100 capitalize">
                  {{ c }}
                </a>
              {% endfor %}
              <a href="/collection?genero={{ g }}&mix_unisex=1" class="py-1.5 px-2 rounded-md hover:bg-gray-100">
                Ver todo {{ g }}
              </a>
            </div>
          </div>
          {% endfor %}
          <a href="/collection?category=ofertas" class="py-1.5 px-2 rounded-md hover:bg-gray-100 text-[#7A0019] font-semibold">
            Ofertas activas
          </a>
        </div>
      </details>

      <a href="/about" class="py-2 px-3 rounded-md hover:bg-gray-100">Sobre Nosotros</a>
      <a href="/contact" class="py-2 px-3 rounded-md hover:bg-gray-100">Contacto</a>

      <a href="/cart" class="py-2 px-3 rounded-md hover:bg-gray-100 flex items-center gap-2">
        <i class="fas fa-shopping-cart"></i> Carrito
        <span class="ml-auto inline-flex items-center justify-center badge-count rounded-full bg-[#D4AF37] text-black font-semibold px-1">
          {{ cart_count|default(0) }}
        </span>
      </a>
    </nav>
  </div>

  <script>
    // --- Mobile toggle
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    menuToggle?.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      menuToggle.setAttribute('aria-expanded', String(!isOpen));
    });

    // --- Mega menu accesible (teclado / click fuera / Escape)
    const trigger = document.getElementById('mega-trigger');
    const panel   = document.getElementById('mega-menu');

    function openMega(){ panel.classList.remove('invisible','opacity-0','translate-y-2'); trigger.setAttribute('aria-expanded','true'); }
    function closeMega(){ panel.classList.add('invisible','opacity-0','translate-y-2');  trigger.setAttribute('aria-expanded','false'); }

    trigger?.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openMega(); panel.querySelector('a')?.focus(); }
      if (e.key === 'Escape') { closeMega(); trigger.focus(); }
    });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMega(); });
    document.addEventListener('click', (e)=>{
      if (!panel.contains(e.target) && !trigger.contains(e.target)) closeMega();
    });
    // Abre al pasar el mouse, cierra al salir (fallback a CSS hover)
    trigger?.addEventListener('mouseenter', openMega);
    trigger?.addEventListener('mouseleave', ()=> setTimeout(()=>{ if(!panel.matches(':hover')) closeMega(); }, 120));
    panel?.addEventListener('mouseleave', closeMega);
  </script>
</header>
